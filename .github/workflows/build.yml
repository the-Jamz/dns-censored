name: Validate Domain List

on:
  push:
    branches:
      - main
    paths:
      - 'domains/uk-blocking-hosts.txt'
  pull_request:
    paths:
      - 'domains/uk-blocking-hosts.txt'
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate domain list format
        run: |
          echo "Validating domain list format..."

          # Check file exists
          if [ ! -f domains/uk-blocking-hosts.txt ]; then
            echo "Error: domains/uk-blocking-hosts.txt not found"
            exit 1
          fi

          # Count domains (non-comment, non-empty lines)
          domain_count=$(grep -v '^#' domains/uk-blocking-hosts.txt | grep -v '^[[:space:]]*$' | wc -l)
          echo "Found $domain_count domains"

          # Validate domains contain dots and no spaces
          invalid_domains=$(grep -v '^#' domains/uk-blocking-hosts.txt | grep -v '^[[:space:]]*$' | grep -v '\.' || true)
          if [ ! -z "$invalid_domains" ]; then
            echo "Error: Invalid domains found (must contain a dot):"
            echo "$invalid_domains"
            exit 1
          fi

          # Check for domains with spaces
          domains_with_spaces=$(grep -v '^#' domains/uk-blocking-hosts.txt | grep -v '^[[:space:]]*$' | grep ' ' || true)
          if [ ! -z "$domains_with_spaces" ]; then
            echo "Error: Domains with spaces found:"
            echo "$domains_with_spaces"
            exit 1
          fi

          echo "✓ Domain list validation passed"
          echo "✓ $domain_count valid domains"
